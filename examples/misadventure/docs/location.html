<!DOCTYPE html>  <html> <head>   <title>location.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="bed_view.html">                 bed_view.js               </a>                                           <a class="source" href="controller.html">                 controller.js               </a>                                           <a class="source" href="location.html">                 location.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               location.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-1">#</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">;(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-2">#</a>               </div>               <h2>Location</h2>

<p>A <code>Location</code> represents a single cell in the corn maze. Locations are created by and
owned by <code>LocationCollection</code> instances. Each Location instance has <code>.north</code>, <code>.east</code>,
<code>.south</code>, and <code>.west</code> attributes, and these attributes are adjacent locations, with a
few special conventions to deal with walls and the final escape from the maze:</p>

<p>If <code>location.north() === location</code>, then that location's north edge has a wall. The
rationale is that if you travel in that direction, you end up in the same place.</p>

<p>If <code>_.isUndefined(location.north() )</code>, then that location's north edge leads out of
the maze. It would be very confusing if that edge is not the edge of the maze,
but this isn't enforced at the moment.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-3">#</a>               </div>               <p>Define <code>Location</code> in global scope</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">Location</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-4">#</a>               </div>               <p>initalize each location to be surrounded by walls</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">([</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">]).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-5">#</a>               </div>               <p>Methods that return the adjacent location, even if it is <code>this</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">north</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span> <span class="p">},</span>
  <span class="nx">south</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span> <span class="p">},</span>
  <span class="nx">west</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span> <span class="p">},</span>
  <span class="nx">east</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span> <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-6">#</a>               </div>               <p>Methods that return whether the adjacent location is a different location and passable.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">has_north</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span> <span class="o">&amp;&amp;</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">has_south</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span> <span class="o">&amp;&amp;</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">has_west</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span> <span class="o">&amp;&amp;</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">has_east</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span> <span class="o">&amp;&amp;</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span><span class="p">;</span> <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-7">#</a>               </div>               <p>Methods that return whether the adjacent location is passable, which could be
an adacent location or an exit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">passage_north</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">passage_south</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">passage_west</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">passage_east</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span><span class="p">;</span> <span class="p">},</span>
  
  </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-8">#</a>               </div>               <p>Methods that return whether the adjacent location is the exit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">escapes_north</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">undefined</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">escapes_south</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">undefined</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">escapes_west</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">undefined</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">escapes_east</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">undefined</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span><span class="p">;</span> <span class="p">}</span>
  
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-9">#</a>               </div>               <h2>LocationCollection</h2>

<p>A <code>LocationCollection</code> represents a corn maze. Every LocationCollection is initialized with a seed,
and it uses <code>math.seedrandom</code> to generate an idempotent pseudo-random maze of locations using
the <a href="http://weblog.jamisbuck.org/2011/1/12/maze-generation-recursive-division-algorithm">Recursive Division</a>
algorithm.</p>

<p>Initializing a LocationCollection generates all of the locations automatically and wires them to each other.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-10">#</a>               </div>               <p>Define <code>LocationCollection</code> in global scope</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">LocationCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  
  <span class="nx">model</span><span class="o">:</span> <span class="nx">Location</span><span class="p">,</span>
  
  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">seed</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">seed</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">_random_string</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">field_width</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="mi">15</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">field_height</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span> <span class="o">||</span> <span class="mi">15</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_regenerate</span><span class="p">();</span>
  <span class="p">},</span>
  
  <span class="nx">_random_string</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">().</span><span class="nx">toString</span><span class="p">().</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-11">#</a>               </div>               <p><strong>Generate a New Maze</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_regenerate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_width</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_height</span><span class="p">;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">seedrandom</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">seed</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-12">#</a>               </div>               <p>Start with a rectangle of locations</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">field</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">height</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">col</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Location</span><span class="p">({</span> <span class="nx">id</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_random_string</span><span class="p">(),</span> <span class="nx">row</span><span class="o">:</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">col</span><span class="o">:</span> <span class="nx">col</span> <span class="p">});</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-13">#</a>               </div>               <p>the centre will be the starting location</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">centre</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)][</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)];</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-14">#</a>               </div>               <p>Create passageways between adjacent locations inside the maze</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">height</span><span class="p">)).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i_row</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">width</span><span class="p">)).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">j_col</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">j_col</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">][</span><span class="nx">j_col</span><span class="p">];</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-15">#</a>               </div>               <p>open one exit</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">which</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">which</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">j_col</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">width</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">).</span><span class="nx">first</span><span class="p">()[</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">which</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">j_col</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">width</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">).</span><span class="nx">last</span><span class="p">()[</span><span class="nx">j_col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">which</span> <span class="o">&lt;</span> <span class="mf">0.75</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i_row</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">height</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">]).</span><span class="nx">first</span><span class="p">().</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i_row</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">height</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">i_row</span><span class="p">]).</span><span class="nx">last</span><span class="p">().</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-16">#</a>               </div>               <p>recursively bisect the field until it is a maze</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">_recursive_bisect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-17">#</a>               </div>               <p>refresh the collection</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">));</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-18">#</a>               </div>               <p><strong><a href="http://weblog.jamisbuck.org/2011/1/12/maze-generation-recursive-division-algorithm">Recursive Division</a></strong></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">_recursive_bisect</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">low_row</span><span class="p">,</span> <span class="nx">high_row</span><span class="p">,</span> <span class="nx">low_col</span><span class="p">,</span> <span class="nx">high_col</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">high_row</span> <span class="o">-</span> <span class="nx">low_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">high_col</span> <span class="o">-</span> <span class="nx">low_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">height</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bisection_west</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">width</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">bisection_west</span> <span class="o">=</span> <span class="nx">low_col</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="nx">bisection_west</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nx">low_col</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">opening</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">height</span><span class="p">)</span> <span class="o">+</span> <span class="nx">low_row</span><span class="p">;</span>
      <span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">low_row</span><span class="p">,</span> <span class="nx">high_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">chain</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">opening</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">bisection_west</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">east</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">bisection_west</span><span class="p">];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">bisection_west</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">west</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">row</span><span class="p">][</span><span class="nx">bisection_west</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_recursive_bisect</span><span class="p">(</span><span class="nx">low_row</span><span class="p">,</span> <span class="nx">high_row</span><span class="p">,</span> <span class="nx">low_col</span><span class="p">,</span> <span class="nx">bisection_west</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_recursive_bisect</span><span class="p">(</span><span class="nx">low_row</span><span class="p">,</span> <span class="nx">high_row</span><span class="p">,</span> <span class="nx">bisection_west</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">high_col</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">bisection_low</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">height</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">bisection_low</span> <span class="o">=</span> <span class="nx">low_row</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="nx">bisection_low</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="nx">low_row</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">opening</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">width</span><span class="p">)</span> <span class="o">+</span> <span class="nx">low_col</span><span class="p">;</span>
      <span class="nx">_</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">low_col</span><span class="p">,</span> <span class="nx">high_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">chain</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">opening</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">col</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">bisection_low</span><span class="p">][</span><span class="nx">col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">south</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">bisection_low</span><span class="p">][</span><span class="nx">col</span><span class="p">];</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">bisection_low</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="nx">col</span><span class="p">].</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">north</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field</span><span class="p">[</span><span class="nx">bisection_low</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="nx">col</span><span class="p">];</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_recursive_bisect</span><span class="p">(</span><span class="nx">low_row</span><span class="p">,</span> <span class="nx">bisection_low</span><span class="p">,</span> <span class="nx">low_col</span><span class="p">,</span> <span class="nx">high_col</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_recursive_bisect</span><span class="p">(</span><span class="nx">bisection_low</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">high_row</span><span class="p">,</span> <span class="nx">low_col</span><span class="p">,</span> <span class="nx">high_col</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
<span class="p">},</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-19">#</a>               </div>               <p>A simple class-based cache to eliminate regenerating the maze on every page
refresh</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">find_or_create</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{});</span>
      <span class="kd">var</span> <span class="nx">lc</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">seed</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">lc</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LocationCollection</span><span class="p">([]);</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">lc</span><span class="p">.</span><span class="nx">seed</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lc</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">seed</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nx">lc</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LocationCollection</span><span class="p">([],</span> <span class="nx">options</span><span class="p">);</span>
        <span class="nx">cache</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">seed</span><span class="p">]</span> <span class="o">=</span> <span class="nx">lc</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="nx">lc</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">seed</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">lc</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">})()</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-20">#</a>               </div>               <h2>LocationView</h2>

<p>A <code>LocationView</code> handles displaying what the user sees at every location as they work their way through
the maze. The <code>/haml/location.haml</code> template specifies exactly what to display on the page, at this
time the view class encapsulates a little logic about a text description.</p>

<p>Future expansions might include logic for displaying a picture or a partial map of the maze, stuff
that should not be embedded in the template. Likewise, ther might be more complex interactivity that
would require handling events in the view class.</p>

<p>View classes in Backbone.js are usually all about displaying updated models and handling events.
Since Misadventure's models are read-only, we don't need to worry about much in the way of wiring
change events.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-21">#</a>               </div>               <p>Define <code>LocationView</code> in global scope.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">LocationView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-22">#</a>               </div>               <p><code>keydown</code> events are sent to input elements that have focus and 
to the document. We want them even though there's no input
element to have focus, so we'll bind our own handler to the
document. But first, we remove any other keydown event handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">before_render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;keydown.LocationView&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-23">#</a>               </div>               <p>After the template has been rendered, we bind our own handler to the
document.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">after_render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keydown.LocationView&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ol#&#39;</span> <span class="o">+</span> <span class="nx">view</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">id</span> <span class="p">);</span>
      <span class="kd">var</span> <span class="nx">keyCode</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">arrow</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">left</span><span class="o">:</span> <span class="mi">37</span><span class="p">,</span> <span class="nx">up</span><span class="o">:</span> <span class="mi">38</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span> <span class="nx">down</span><span class="o">:</span> <span class="mi">40</span> <span class="p">};</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">does_not_exist</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">up</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">view</span><span class="p">.</span><span class="nx">go_north</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">down</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">view</span><span class="p">.</span><span class="nx">go_south</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">view</span><span class="p">.</span><span class="nx">go_west</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="nx">arrow</span><span class="p">.</span><span class="nx">right</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">view</span><span class="p">.</span><span class="nx">go_east</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-24">#</a>               </div>               <p>travel north if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">go_north</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_north</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">location</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">north</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">escapes_north</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">bed</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-25">#</a>               </div>               <p>travel south if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">go_south</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_south</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">location</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">south</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">escapes_south</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">bed</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-26">#</a>               </div>               <p>travel east if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">go_east</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_east</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">location</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">east</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">escapes_east</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">bed</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-27">#</a>               </div>               <p>travel west if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">go_west</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_west</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">location</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">west</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">escapes_west</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">bed</span><span class="p">({</span> <span class="nx">location</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">},</span>
  </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-28">#</a>               </div>               <p>The text description is a clumsy homage to <a href="http://raganwald.github.com/faux/examples/misadventure/">Adventure</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">text_description</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">descriptions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a hole with no way out&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a little maize of twisting passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a little maize of twisty passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a little twisty maize of passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a maize of little twisting passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a maize of little twisty passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a maize of twisting little passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a maize of twisty little passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a twisting little maize of passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a twisting maize of little passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a twisty little maize of passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a twisty maize of little passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;a little twisting maize of passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;amazing little twisting passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;amazing little twisty passages&#39;</span><span class="p">,</span>
      <span class="s1">&#39;amazing twisting little passages&#39;</span><span class="p">];</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">descriptions</span><span class="p">[</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_north</span><span class="p">()</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_south</span><span class="p">()</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_west</span><span class="p">()</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_east</span><span class="p">()</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">];</span>
    <span class="p">};</span>
  <span class="p">})(),</span>
  </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-29">#</a>               </div>               <p>a rough approximation of what you might see here</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">passage_image_source</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">passages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./images/passages1.png&#39;</span><span class="p">,</span>
      <span class="s1">&#39;./images/passages1.png&#39;</span><span class="p">,</span>
      <span class="s1">&#39;./images/passages2.png&#39;</span><span class="p">,</span>
      <span class="s1">&#39;./images/passages3.png&#39;</span><span class="p">,</span>
      <span class="s1">&#39;./images/passages4.png&#39;</span><span class="p">];</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">passages</span><span class="p">[</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_north</span><span class="p">()</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_south</span><span class="p">()</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_west</span><span class="p">()</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> 
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">has_east</span><span class="p">()</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">];</span>
    <span class="p">};</span>
  <span class="p">})()</span>
  
<span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-30">#</a>               </div>               <p>This file is part of <a href="http://github.com/raganwald/faux/examples/misadventure">Misadventure</a>, an extremely 
simple <a href="http://www.digitalhumanities.org/dhq/vol/001/2/000009/000009.html">adventure</a> game written as an example app for <a href="https://github.com/raganwald/faux">Faux</a>.
You can play the game <a href="http://raganwald.github.com/faux/examples/misadventure">here</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-31">#</a>               </div>               <h2>License Terms</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>

<span class="cm">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="cm">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="cm">THE SOFTWARE.</span>

<span class="cm">To the extent possible under law, Unspace Interactive has waived all copyright </span>
<span class="cm">and related or neighboring rights to the software, except for those portions</span>
<span class="cm">that are otherwise licensed.</span>

<span class="cm">This work is published from Canada.</span>

<span class="cm">*/</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 